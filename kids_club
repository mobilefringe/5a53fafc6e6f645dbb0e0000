<div class="inside_banner">   
    <div class="content_container">
        <div class="inside_banner_content">
            <div class="row">
                <div class="col-md-12">
                    <h1 id="mm_page_title"></h1>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="content_container margin_30 kids_club_container">
    <div class="margin_30"></div>
    <div class="row">
        <div class="col-md-12">
            <div id="mm_page_content"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h3>Kids Club Registration</h3>
            <form id="contest_form">
                <input id="property_id" name="contest[property_id]" type="hidden" value="{{property_id}}"/>
                <input id="contest_id" name="contest[contest_id]" type="hidden"  value="{{id}}" />
                <input class="form-control" id="notes" name="contest[notes]" type="hidden"  required data-validation="required" tabindex="1"/>
                <input type="hidden" name="cm-name" id="cm-name" />
                <div class="row">
                    <div class="col-sm-6">
                        <label for="notes">Child's First Name</label> <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_first_name" type="text" required data-validation="required" tabindex="2"/>
                    </div>
                    <div class="col-sm-6">
                        <label for="notes">Child's Last Name</label> <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_last_name"  type="text" required data-validation="required" tabindex="3"/>
                    </div>
                    <div class="col-sm-6">
                        <label for="address">Street Address</label>  <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_address" name="contest[mailing_address]" type="text" required data-validation="required" tabindex="4"/>    
                    </div>
                    <div class="col-sm-6">
                        <label for="postal_code">Postal Code</label>  <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_postal_code" name="contest[postal_code]" type="text" required data-validation="required" tabindex="5"/>
                    </div>
                    <div class="col-sm-6 ">
                        <label for="phone">Phone Number</label>  <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_phone" name="contest[phone]" type="text" required data-validation="required" tabindex="6"/>    
                    </div>
                    <div class="col-sm-6">
                        <label for="birthday">Child's Birthday (yyyy-mm-dd) </label>  <span style="color:red"> *</span>
                        <input class="form-control" id="loyalty_birthday" name="contest[birthday]" type="text" required data-validation="required" tabindex="7"/>    
                    </div>
                    <div class="col-sm-6 ">
                        <label for="first_name">Parent's First Name</label>  <span style="color:red"> *</span>
                        <input class="form-control" id="first_name" name="contest[first_name]" type="text" required data-validation="required" tabindex="8"/>
                    </div>
                    <div class="col-sm-6 ">
                        <label for="last_name">Parent's Last Name</label>  <span style="color:red"> *</span>
                        <input class="form-control" id="last_name" name="contest[last_name]" type="text" required data-validation="required" tabindex="9"/>
                    </div>
                    <div class="col-sm-6">
                        <label for="email">Parent's Email</label> <span style="color:red"> *</span>
                        <input class="form-control" id="email" name="contest[email]" type="email" required data-validation-regexp="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$" data-validation-error-msg="Please enter a valid email address" data-validation="custom" tabindex="10"/>
                    </div>
                     <div class="col-sm-6">
                        <label for="reason">How did you hear about the St Vital Centre Kids Centre?</label>  <span style="color:red"> *</span>
                        <select id="reason" class="form-control" tabindex="11">
                            <option value="" disabled selected>Select One</option>
                        	<option value="In St Vital Centre">In St Vital Centre</option>
                        	<option value="St Vital Centre website">St Vital Centre website</option>
                        	<option value="From a friend">From a friend</option>
                        	<option value="At a Kids Club event">At a Kids Club event</option>
                        	<option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-12">
                        <label class="agree">
                            <input id="agree_to_conditions" required type="checkbox" tabindex="12" /> 
                                I would like to receive communications from St. Vital Centre on specials and events for the kids club. I have read and understood the privacy policy.*
                        </label>
                        
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12" style="float: none;">
                        <!--<br/><br/>-->
                        <button class="contact_btn" tabindex="13" style="float:left;">Submit</button>
                        <!--<br/><br/>-->
                    </div>
                    <div id="success_subscribe_popup" class="hidden_now">
                        <div class="alert alert-success fade in" style="margin-top:18px;">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>
                            <strong>Success!</strong> Thank you, your entry has been received.
                        </div>
                    </div>
                    <div id="error_subscribe_popup" class="hidden_now">
                        <div class="alert alert-error fade in" style="margin-top:12px;">
                            <a href="#" class="close" data-dismiss="alert" aria-label="close" title="close">×</a>
                            <strong>Sorry!</strong> There was a problem submiting your request. Please try again later!
                        </div>
                    </div>
                    <br/><br/>
                </div>
            </form>
            <form id="kids_agency_form" action="http://app.emediatemail.com/t/r/s/jtoujj/" method="post" style="display:none">
                <input id="fieldName_kids_agency" name="cm-name" type="text" align="top"/>
                <input id="fieldEmail_kids_agency" name="cm-jtoujj-jtoujj" type="email"/>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <h3>Kids Club Discount</h3>
            <ul id="discount_container" class="info-list wide">
                <script id="discount_template" type="x-tmpl-mustache/text">
                <li>
                    <strong><a href="{{url}}">{{name}}</a></strong>
        			<span>{{description}}</span>
        		</li>
                </script>
            </ul>
        </div>
    </div>
</div>
<style>
    .info-list li {
        border-bottom: 1px dotted #777777;
        clear: both;
        display: block;
        line-height: 1;
        margin-bottom: 10px;
        position: relative;
    }
    .info-list li strong {
        padding: 0 2px 2px 0;
    }
    .info-list li strong, .info-list li span {
        background: none repeat scroll 0 0 #FFFFFF;
        display: inline-block;
        margin-bottom: 0;
        position: relative;
        top: 6px;
    }
    .info-list.wide span {
        line-height: normal;
        margin-bottom: 10px;
        width: 50%;
    }
    .info-list li span {
        float: right;
        padding: 0 0 2px 2px;
    }
</style>
<script>
    $(document).ready(function(e){
        init(e);
        function renderAll(){
            // var pathArray = window.location.pathname.split( '/' );
            // var slug = pathArray[pathArray.length-1];
            prefix = get_prefix();
            var pages_json = prefix + "/pages/svc-kids-club.json"
            $.getJSON(pages_json).done(function(data) {
                $('#mm_page_title').html(data.title.toUpperCase());
                $('#mm_page_content').html(data.body);
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#404_msg").fadeIn("fast");
                }
            }); 
             // kids club discounts
            var repo = getRepoDetailsByName("kids club discounts");
            if (repo != undefined) {
                // var banner = getImageURL(repo.images[0].photo_url);
                // $(".inside_banner").css({backgroundImage: "url(" + banner + ")"});
                var discounts = repo.images;
                renderGeneral("#discount_container","#discount_template",discounts);
                console.log("repo",discounts);
                
            }
           
            $.validate();
            var contest_details = getContestBySlug('svc-kids-club'); 
            var property = getPropertyDetails ();
            console.log(contest_details, property);
            $('#contest_id').val(contest_details.id);
            $('#property_id').val(property.id);
            $('#contest_form').submit(function(e){
                
                e.preventDefault();
                
                // $('.contest_btn').prop('disabled', true);
                // var child_name = $("#child_lname").val()  + " " + $("#child_fname").val();
                // var notes= "Child's name: " + child_name + " . Heard about it through: " + $("#reason").val();
                // $("#notes").val(notes);
                // console.log($("#notes").val());
                // submit_form_data($(this).serialize());
                // $('html, body').animate({scrollBottom : 0},800);
                
                var data = {}
                var loyalty = {}
                loyalty["property_id"] = property.id;
                loyalty["first_name"] = $("#loyalty_first_name").val();
                loyalty["last_name"] = $("#loyalty_last_name").val();
                loyalty["address"] = $("#loyalty_address").val();
                loyalty["postal_code"] = $("#loyalty_postal_code").val();
                loyalty["phone"] = $("#loyalty_phone").val();
                loyalty["birthday"] = $("#loyalty_birthday_year").val() +"-"+ $("#loyalty_birthday_month").val() +"-"+ $("#loyalty_birthday_day").val();
                loyalty["parent_name"] = $("#loyalty_parent_name").val();
                loyalty["email"] = $("#loyalty_email").val();
                loyalty["note"] = $("#loyalty_note").val();
                
                var newsletter;
                if ($("#loyalty_newsletter").prop('checked') == true){
                    newsletter = true;
                } else {
                    newsletter = false;
                }
                
                loyalty["newsletter"] = newsletter;                
                data["loyalty"] = loyalty;
                data["custom_email"] = "true";
                data["custom_email_to"] = "stvguestservices@20vic.com";                
                data["custom_email_subject"] = "New Kids Club Signup"
                var email_body = {}
                email_body["Childs_Name"] = $("#loyalty_first_name").val() + " " + $("#loyalty_last_name").val();
                email_body["Address_And_Postal_Code"] = $("#loyalty_address").val() + " - " + $("#loyalty_postal_code").val();
                email_body["Phone_Number"] = $("#loyalty_phone").val();
                email_body["Birthday"] = $("#loyalty_birthday").val();
                email_body["Parents_Name"] = $("#loyalty_parent_name").val();
                email_body["Parents_Email"] = $("#loyalty_email").val();
                data["custom_email_body"] = email_body;
                
                $.ajax({
                    url: "/add_loyalty",
                    type: "POST",
                    data: data,
                	success: function(response){     
                        if (newsletter){
                            signup_kids_club_agency();
                	    }
                        else{
                            window.location.href = "/pages/svc-thanks"
                        }
        			},
                    error: function(xhr, ajaxOptions, thrownError){
                        alert("Please try again later.");
        			}
                })
            });
            show_content();
        }
        function signup_kids_club(){
            $(".required").hide();
            var valid = true;
            if ($("#loyalty_first_name").val() == ""){
                $("#loyalty_first_name_required").show();  
                valid = false;
            }
            if ($("#loyalty_last_name").val() == ""){
                $("#loyalty_last_name_required").show();  
                valid = false;
            }
            if ($("#loyalty_address").val() == ""){
                $("#loyalty_address_required").show();  
                valid = false;
            }
            if ($("#loyalty_postal_code").val() == ""){
                $("#loyalty_postal_code_required").show();  
                valid = false;
            }
            if ($("#loyalty_phone").val() == ""){
                $("#loyalty_phone_required").show(); 
                valid = false;
            }
            if ($("#loyalty_parent_name").val() == ""){
                $("#loyalty_parent_name_required").show(); 
                valid = false;
            }
            if ($("#loyalty_email").val() == ""){
                $("#loyalty_email_required").text("This field cannot be left blank");
                $("#loyalty_email_required").show(); 
                valid = false;
            } else if (!isValidEmailAddress($("#loyalty_email").val())) { 
                valid = false;
                $("#loyalty_email_required").text("This must be a valid email address.");
                $("#loyalty_email_required").show();
            }           
            
            if (valid){
                
            }
            
        }
        function signup_kids_club_agency(){
            $('#fieldName_kids_agency').val($("#loyalty_parent_name").val());
            $('#fieldEmail_kids_agency').val($("#loyalty_email").val());
            $('form#kids_agency_form').submit();
        }
        $('form#kids_agency_form').submit(function (e) {
            e.preventDefault();
            $.getJSON(
                this.action + "?callback=?",
                $(this).serialize(),
                function (data) {
                    if (data.Status === 400) {
                        alert("Please try again later.");
                    } else { // 200
                	    window.location.href = "/pages/svc-thanks"
                    }
            });
        });
        loadMallDataCached(renderAll); 
    })
</script>